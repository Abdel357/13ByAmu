{"ast":null,"code":"import { __decorate } from \"tslib\";\nimport { Component } from \"@angular/core\";\nimport { FormControl, FormGroup, Validators } from \"@angular/forms\";\nimport { environment } from \"src/environment/environment\";\nlet ForumComponent = class ForumComponent {\n  constructor(forumservice, router, toastr, http, connectionService) {\n    this.forumservice = forumservice;\n    this.router = router;\n    this.toastr = toastr;\n    this.http = http;\n    this.connectionService = connectionService;\n    this.url_publication = environment.api_url + \"/publication\";\n    this.url_comment = environment.api_url + \"/comment\";\n    this.publications = [];\n    this.comments = [];\n    this.publicationForm = new FormGroup({\n      title: new FormControl(\"\", [Validators.required, Validators.minLength(5)]),\n      publication: new FormControl(\"\", [Validators.required, Validators.minLength(10)])\n    });\n    this.commentForm = new FormGroup({\n      comment: new FormControl(\"\", [Validators.required, Validators.minLength(10)])\n    });\n    this.showForm = false;\n    this.title = \"\";\n    this.publication = \"\";\n    this.selectedPublication = null;\n  }\n  ngOnInit() {\n    this.connectionService.isUserLoggedIn$.subscribe(loggedIn => this.isLoggedIn = loggedIn);\n    if (this.isLoggedIn == false) {\n      this.router.navigate([\"/log\"]);\n    }\n    this.getPublications();\n    this.getComments();\n  }\n  getPublications() {\n    this.http.get(this.url_publication).subscribe(publicationsWithUserInfo => {\n      this.publications = publicationsWithUserInfo;\n      console.log(this.publications);\n    }, error => {\n      console.error(error);\n    });\n  }\n  getComments() {\n    this.http.get(this.url_comment).subscribe(comments => {\n      this.comments = comments;\n      console.log(this.comments);\n    }, error => {\n      console.error(error);\n    });\n  }\n  submit() {\n    const value = this.publicationForm.value;\n    this.forumservice.poste(value).subscribe(res => {\n      if (res.success) {\n        this.router.navigate([res.redirectUrl]);\n        this.toastr.success(\"Publication ajouté avec succès\", \"Succès\");\n      }\n      setTimeout(() => {\n        location.reload();\n      }, 1000);\n    });\n  }\n  submitComment(idPublication) {\n    const value = this.commentForm.value;\n    this.forumservice.posteComment(value, idPublication).subscribe(res => {\n      if (res.success) {\n        this.router.navigate([res.redirectUrl]);\n        this.toastr.success(\"Commentaire ajouté avec succès\", \"Succès\");\n      }\n      setTimeout(() => {\n        location.reload();\n      }, 1000);\n    });\n  }\n  cancelForm() {\n    this.title = \"\";\n    this.publication = \"\";\n    this.showForm = false;\n  }\n  openPopup(publication) {\n    this.selectedPublication = publication;\n  }\n  closePopup() {\n    this.selectedPublication = null;\n  }\n  filterByDate(selectedValue) {\n    const currentDate = new Date();\n    const filteredPublications = this.publications.filter(publication => {\n      const publicationDate = new Date(publication.datePublication);\n      if (selectedValue === \"week\") {\n        const currentWeekStart = new Date(currentDate.getFullYear(), currentDate.getMonth(), currentDate.getDate() - currentDate.getDay());\n        const currentWeekEnd = new Date(currentDate.getFullYear(), currentDate.getMonth(), currentDate.getDate() + (6 - currentDate.getDay()));\n        return publicationDate >= currentWeekStart && publicationDate <= currentWeekEnd;\n      } else if (selectedValue === \"month\") {\n        const currentMonthStart = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1);\n        const currentMonthEnd = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 0);\n        return publicationDate >= currentMonthStart && publicationDate <= currentMonthEnd;\n      } else if (selectedValue === \"year\") {\n        const currentYearStart = new Date(currentDate.getFullYear(), 0, 1);\n        const currentYearEnd = new Date(currentDate.getFullYear(), 11, 31);\n        return publicationDate >= currentYearStart && publicationDate <= currentYearEnd;\n      } else {\n        return true;\n      }\n    });\n    this.publications = filteredPublications.reverse();\n  }\n  filterByType(selectedValue) {\n    const sessionData = JSON.parse(sessionStorage.getItem(\"sessionData\") || \"{}\");\n    const userId = sessionData.idUser;\n    if (selectedValue === \"all\") {\n      // Show all publications\n      this.publications.forEach(publication => {\n        publication.show = true;\n      });\n    } else if (selectedValue === \"my\") {\n      // Show only user's publications\n      this.publications.forEach(publication => {\n        publication.show = publication.idUser === userId;\n      });\n    }\n  }\n};\nForumComponent = __decorate([Component({\n  selector: \"app-forum\",\n  templateUrl: \"./forum.component.html\",\n  styleUrls: [\"./forum.component.css\"]\n})], ForumComponent);\nexport { ForumComponent };","map":{"version":3,"names":["Component","FormControl","FormGroup","Validators","environment","ForumComponent","constructor","forumservice","router","toastr","http","connectionService","url_publication","api_url","url_comment","publications","comments","publicationForm","title","required","minLength","publication","commentForm","comment","showForm","selectedPublication","ngOnInit","isUserLoggedIn$","subscribe","loggedIn","isLoggedIn","navigate","getPublications","getComments","get","publicationsWithUserInfo","console","log","error","submit","value","poste","res","success","redirectUrl","setTimeout","location","reload","submitComment","idPublication","posteComment","cancelForm","openPopup","closePopup","filterByDate","selectedValue","currentDate","Date","filteredPublications","filter","publicationDate","datePublication","currentWeekStart","getFullYear","getMonth","getDate","getDay","currentWeekEnd","currentMonthStart","currentMonthEnd","currentYearStart","currentYearEnd","reverse","filterByType","sessionData","JSON","parse","sessionStorage","getItem","userId","idUser","forEach","show","__decorate","selector","templateUrl","styleUrls"],"sources":["C:\\Users\\Youssef EL-HAMRANI\\Desktop\\Node js\\NEW PFE\\project_pfe-frontend\\frontend\\src\\app\\components\\forum\\forum.component.ts"],"sourcesContent":["import { Component, OnInit } from \"@angular/core\";\nimport { FormControl, FormGroup, Validators } from \"@angular/forms\";\nimport { ForumService } from \"src/app/services/forum.service\";\nimport { Router } from \"@angular/router\";\nimport { ToastrService } from \"ngx-toastr\";\nimport { environment } from \"src/environment/environment\";\nimport { HttpClient } from \"@angular/common/http\";\nimport { ConnectionService } from \"src/app/services/connection.service\";\n\n@Component({\n  selector: \"app-forum\",\n  templateUrl: \"./forum.component.html\",\n  styleUrls: [\"./forum.component.css\"],\n})\nexport class ForumComponent implements OnInit {\n  url_publication = environment.api_url + \"/publication\";\n  url_comment = environment.api_url + \"/comment\";\n\n  isLoggedIn!: boolean;\n\n  publications: any[] = [];\n  comments: any[] = [];\n\n  publicationForm: FormGroup = new FormGroup({\n    title: new FormControl(\"\", [Validators.required, Validators.minLength(5)]),\n    publication: new FormControl(\"\", [\n      Validators.required,\n      Validators.minLength(10),\n    ]),\n  });\n\n  commentForm: FormGroup = new FormGroup({\n    comment: new FormControl(\"\", [\n      Validators.required,\n      Validators.minLength(10),\n    ]),\n  });\n\n  constructor(\n    private forumservice: ForumService,\n    private router: Router,\n    private toastr: ToastrService,\n    private http: HttpClient,\n    private connectionService: ConnectionService\n  ) {}\n\n  ngOnInit(): void {\n    this.connectionService.isUserLoggedIn$.subscribe(\n      (loggedIn) => (this.isLoggedIn = loggedIn)\n    );\n\n    if (this.isLoggedIn == false) {\n      this.router.navigate([\"/log\"]);\n    }\n\n    this.getPublications();\n    this.getComments();\n  }\n\n  getPublications(): void {\n    this.http.get<any[]>(this.url_publication).subscribe(\n      (publicationsWithUserInfo) => {\n        this.publications = publicationsWithUserInfo;\n        console.log(this.publications);\n      },\n      (error) => {\n        console.error(error);\n      }\n    );\n  }\n\n  getComments() {\n    this.http.get<any[]>(this.url_comment).subscribe(\n      (comments) => {\n        this.comments = comments;\n        console.log(this.comments);\n      },\n      (error) => {\n        console.error(error);\n      }\n    );\n  }\n\n  submit() {\n    const value = this.publicationForm.value;\n    this.forumservice.poste(value).subscribe((res) => {\n      if (res.success) {\n        this.router.navigate([res.redirectUrl]);\n        this.toastr.success(\"Publication ajouté avec succès\", \"Succès\");\n      }\n      setTimeout(() => {\n        location.reload();\n      }, 1000);\n    });\n  }\n\n  submitComment(idPublication: number) {\n    const value = this.commentForm.value;\n    this.forumservice.posteComment(value, idPublication).subscribe((res) => {\n      if (res.success) {\n        this.router.navigate([res.redirectUrl]);\n        this.toastr.success(\"Commentaire ajouté avec succès\", \"Succès\");\n      }\n      setTimeout(() => {\n        location.reload();\n      }, 1000);\n    });\n  }\n\n  showForm = false;\n  title = \"\";\n  publication = \"\";\n\n  cancelForm(): void {\n    this.title = \"\";\n    this.publication = \"\";\n    this.showForm = false;\n  }\n\n  selectedPublication: any = null;\n  openPopup(publication: any): void {\n    this.selectedPublication = publication;\n  }\n\n  closePopup(): void {\n    this.selectedPublication = null;\n  }\n\n  filterByDate(selectedValue: string) {\n    const currentDate = new Date();\n    const filteredPublications = this.publications.filter((publication) => {\n      const publicationDate = new Date(publication.datePublication);\n      if (selectedValue === \"week\") {\n        const currentWeekStart = new Date(\n          currentDate.getFullYear(),\n          currentDate.getMonth(),\n          currentDate.getDate() - currentDate.getDay()\n        );\n        const currentWeekEnd = new Date(\n          currentDate.getFullYear(),\n          currentDate.getMonth(),\n          currentDate.getDate() + (6 - currentDate.getDay())\n        );\n        return (\n          publicationDate >= currentWeekStart &&\n          publicationDate <= currentWeekEnd\n        );\n      } else if (selectedValue === \"month\") {\n        const currentMonthStart = new Date(\n          currentDate.getFullYear(),\n          currentDate.getMonth(),\n          1\n        );\n        const currentMonthEnd = new Date(\n          currentDate.getFullYear(),\n          currentDate.getMonth() + 1,\n          0\n        );\n        return (\n          publicationDate >= currentMonthStart &&\n          publicationDate <= currentMonthEnd\n        );\n      } else if (selectedValue === \"year\") {\n        const currentYearStart = new Date(currentDate.getFullYear(), 0, 1);\n        const currentYearEnd = new Date(currentDate.getFullYear(), 11, 31);\n        return (\n          publicationDate >= currentYearStart &&\n          publicationDate <= currentYearEnd\n        );\n      } else {\n        return true;\n      }\n    });\n    this.publications = filteredPublications.reverse();\n  }\n\n  filterByType(selectedValue: string) {\n    const sessionData = JSON.parse(\n      sessionStorage.getItem(\"sessionData\") || \"{}\"\n    );\n    const userId = sessionData.idUser;\n\n    if (selectedValue === \"all\") {\n      // Show all publications\n      this.publications.forEach((publication) => {\n        publication.show = true;\n      });\n    } else if (selectedValue === \"my\") {\n      // Show only user's publications\n      this.publications.forEach((publication) => {\n        publication.show = publication.idUser === userId;\n      });\n    }\n  }\n}\n"],"mappings":";AAAA,SAASA,SAAS,QAAgB,eAAe;AACjD,SAASC,WAAW,EAAEC,SAAS,EAAEC,UAAU,QAAQ,gBAAgB;AAInE,SAASC,WAAW,QAAQ,6BAA6B;AASlD,IAAMC,cAAc,GAApB,MAAMA,cAAc;EAwBzBC,YACUC,YAA0B,EAC1BC,MAAc,EACdC,MAAqB,EACrBC,IAAgB,EAChBC,iBAAoC;IAJpC,KAAAJ,YAAY,GAAZA,YAAY;IACZ,KAAAC,MAAM,GAANA,MAAM;IACN,KAAAC,MAAM,GAANA,MAAM;IACN,KAAAC,IAAI,GAAJA,IAAI;IACJ,KAAAC,iBAAiB,GAAjBA,iBAAiB;IA5B3B,KAAAC,eAAe,GAAGR,WAAW,CAACS,OAAO,GAAG,cAAc;IACtD,KAAAC,WAAW,GAAGV,WAAW,CAACS,OAAO,GAAG,UAAU;IAI9C,KAAAE,YAAY,GAAU,EAAE;IACxB,KAAAC,QAAQ,GAAU,EAAE;IAEpB,KAAAC,eAAe,GAAc,IAAIf,SAAS,CAAC;MACzCgB,KAAK,EAAE,IAAIjB,WAAW,CAAC,EAAE,EAAE,CAACE,UAAU,CAACgB,QAAQ,EAAEhB,UAAU,CAACiB,SAAS,CAAC,CAAC,CAAC,CAAC,CAAC;MAC1EC,WAAW,EAAE,IAAIpB,WAAW,CAAC,EAAE,EAAE,CAC/BE,UAAU,CAACgB,QAAQ,EACnBhB,UAAU,CAACiB,SAAS,CAAC,EAAE,CAAC,CACzB;KACF,CAAC;IAEF,KAAAE,WAAW,GAAc,IAAIpB,SAAS,CAAC;MACrCqB,OAAO,EAAE,IAAItB,WAAW,CAAC,EAAE,EAAE,CAC3BE,UAAU,CAACgB,QAAQ,EACnBhB,UAAU,CAACiB,SAAS,CAAC,EAAE,CAAC,CACzB;KACF,CAAC;IAyEF,KAAAI,QAAQ,GAAG,KAAK;IAChB,KAAAN,KAAK,GAAG,EAAE;IACV,KAAAG,WAAW,GAAG,EAAE;IAQhB,KAAAI,mBAAmB,GAAQ,IAAI;EA3E5B;EAEHC,QAAQA,CAAA;IACN,IAAI,CAACf,iBAAiB,CAACgB,eAAe,CAACC,SAAS,CAC7CC,QAAQ,IAAM,IAAI,CAACC,UAAU,GAAGD,QAAS,CAC3C;IAED,IAAI,IAAI,CAACC,UAAU,IAAI,KAAK,EAAE;MAC5B,IAAI,CAACtB,MAAM,CAACuB,QAAQ,CAAC,CAAC,MAAM,CAAC,CAAC;;IAGhC,IAAI,CAACC,eAAe,EAAE;IACtB,IAAI,CAACC,WAAW,EAAE;EACpB;EAEAD,eAAeA,CAAA;IACb,IAAI,CAACtB,IAAI,CAACwB,GAAG,CAAQ,IAAI,CAACtB,eAAe,CAAC,CAACgB,SAAS,CACjDO,wBAAwB,IAAI;MAC3B,IAAI,CAACpB,YAAY,GAAGoB,wBAAwB;MAC5CC,OAAO,CAACC,GAAG,CAAC,IAAI,CAACtB,YAAY,CAAC;IAChC,CAAC,EACAuB,KAAK,IAAI;MACRF,OAAO,CAACE,KAAK,CAACA,KAAK,CAAC;IACtB,CAAC,CACF;EACH;EAEAL,WAAWA,CAAA;IACT,IAAI,CAACvB,IAAI,CAACwB,GAAG,CAAQ,IAAI,CAACpB,WAAW,CAAC,CAACc,SAAS,CAC7CZ,QAAQ,IAAI;MACX,IAAI,CAACA,QAAQ,GAAGA,QAAQ;MACxBoB,OAAO,CAACC,GAAG,CAAC,IAAI,CAACrB,QAAQ,CAAC;IAC5B,CAAC,EACAsB,KAAK,IAAI;MACRF,OAAO,CAACE,KAAK,CAACA,KAAK,CAAC;IACtB,CAAC,CACF;EACH;EAEAC,MAAMA,CAAA;IACJ,MAAMC,KAAK,GAAG,IAAI,CAACvB,eAAe,CAACuB,KAAK;IACxC,IAAI,CAACjC,YAAY,CAACkC,KAAK,CAACD,KAAK,CAAC,CAACZ,SAAS,CAAEc,GAAG,IAAI;MAC/C,IAAIA,GAAG,CAACC,OAAO,EAAE;QACf,IAAI,CAACnC,MAAM,CAACuB,QAAQ,CAAC,CAACW,GAAG,CAACE,WAAW,CAAC,CAAC;QACvC,IAAI,CAACnC,MAAM,CAACkC,OAAO,CAAC,gCAAgC,EAAE,QAAQ,CAAC;;MAEjEE,UAAU,CAAC,MAAK;QACdC,QAAQ,CAACC,MAAM,EAAE;MACnB,CAAC,EAAE,IAAI,CAAC;IACV,CAAC,CAAC;EACJ;EAEAC,aAAaA,CAACC,aAAqB;IACjC,MAAMT,KAAK,GAAG,IAAI,CAAClB,WAAW,CAACkB,KAAK;IACpC,IAAI,CAACjC,YAAY,CAAC2C,YAAY,CAACV,KAAK,EAAES,aAAa,CAAC,CAACrB,SAAS,CAAEc,GAAG,IAAI;MACrE,IAAIA,GAAG,CAACC,OAAO,EAAE;QACf,IAAI,CAACnC,MAAM,CAACuB,QAAQ,CAAC,CAACW,GAAG,CAACE,WAAW,CAAC,CAAC;QACvC,IAAI,CAACnC,MAAM,CAACkC,OAAO,CAAC,gCAAgC,EAAE,QAAQ,CAAC;;MAEjEE,UAAU,CAAC,MAAK;QACdC,QAAQ,CAACC,MAAM,EAAE;MACnB,CAAC,EAAE,IAAI,CAAC;IACV,CAAC,CAAC;EACJ;EAMAI,UAAUA,CAAA;IACR,IAAI,CAACjC,KAAK,GAAG,EAAE;IACf,IAAI,CAACG,WAAW,GAAG,EAAE;IACrB,IAAI,CAACG,QAAQ,GAAG,KAAK;EACvB;EAGA4B,SAASA,CAAC/B,WAAgB;IACxB,IAAI,CAACI,mBAAmB,GAAGJ,WAAW;EACxC;EAEAgC,UAAUA,CAAA;IACR,IAAI,CAAC5B,mBAAmB,GAAG,IAAI;EACjC;EAEA6B,YAAYA,CAACC,aAAqB;IAChC,MAAMC,WAAW,GAAG,IAAIC,IAAI,EAAE;IAC9B,MAAMC,oBAAoB,GAAG,IAAI,CAAC3C,YAAY,CAAC4C,MAAM,CAAEtC,WAAW,IAAI;MACpE,MAAMuC,eAAe,GAAG,IAAIH,IAAI,CAACpC,WAAW,CAACwC,eAAe,CAAC;MAC7D,IAAIN,aAAa,KAAK,MAAM,EAAE;QAC5B,MAAMO,gBAAgB,GAAG,IAAIL,IAAI,CAC/BD,WAAW,CAACO,WAAW,EAAE,EACzBP,WAAW,CAACQ,QAAQ,EAAE,EACtBR,WAAW,CAACS,OAAO,EAAE,GAAGT,WAAW,CAACU,MAAM,EAAE,CAC7C;QACD,MAAMC,cAAc,GAAG,IAAIV,IAAI,CAC7BD,WAAW,CAACO,WAAW,EAAE,EACzBP,WAAW,CAACQ,QAAQ,EAAE,EACtBR,WAAW,CAACS,OAAO,EAAE,IAAI,CAAC,GAAGT,WAAW,CAACU,MAAM,EAAE,CAAC,CACnD;QACD,OACEN,eAAe,IAAIE,gBAAgB,IACnCF,eAAe,IAAIO,cAAc;OAEpC,MAAM,IAAIZ,aAAa,KAAK,OAAO,EAAE;QACpC,MAAMa,iBAAiB,GAAG,IAAIX,IAAI,CAChCD,WAAW,CAACO,WAAW,EAAE,EACzBP,WAAW,CAACQ,QAAQ,EAAE,EACtB,CAAC,CACF;QACD,MAAMK,eAAe,GAAG,IAAIZ,IAAI,CAC9BD,WAAW,CAACO,WAAW,EAAE,EACzBP,WAAW,CAACQ,QAAQ,EAAE,GAAG,CAAC,EAC1B,CAAC,CACF;QACD,OACEJ,eAAe,IAAIQ,iBAAiB,IACpCR,eAAe,IAAIS,eAAe;OAErC,MAAM,IAAId,aAAa,KAAK,MAAM,EAAE;QACnC,MAAMe,gBAAgB,GAAG,IAAIb,IAAI,CAACD,WAAW,CAACO,WAAW,EAAE,EAAE,CAAC,EAAE,CAAC,CAAC;QAClE,MAAMQ,cAAc,GAAG,IAAId,IAAI,CAACD,WAAW,CAACO,WAAW,EAAE,EAAE,EAAE,EAAE,EAAE,CAAC;QAClE,OACEH,eAAe,IAAIU,gBAAgB,IACnCV,eAAe,IAAIW,cAAc;OAEpC,MAAM;QACL,OAAO,IAAI;;IAEf,CAAC,CAAC;IACF,IAAI,CAACxD,YAAY,GAAG2C,oBAAoB,CAACc,OAAO,EAAE;EACpD;EAEAC,YAAYA,CAAClB,aAAqB;IAChC,MAAMmB,WAAW,GAAGC,IAAI,CAACC,KAAK,CAC5BC,cAAc,CAACC,OAAO,CAAC,aAAa,CAAC,IAAI,IAAI,CAC9C;IACD,MAAMC,MAAM,GAAGL,WAAW,CAACM,MAAM;IAEjC,IAAIzB,aAAa,KAAK,KAAK,EAAE;MAC3B;MACA,IAAI,CAACxC,YAAY,CAACkE,OAAO,CAAE5D,WAAW,IAAI;QACxCA,WAAW,CAAC6D,IAAI,GAAG,IAAI;MACzB,CAAC,CAAC;KACH,MAAM,IAAI3B,aAAa,KAAK,IAAI,EAAE;MACjC;MACA,IAAI,CAACxC,YAAY,CAACkE,OAAO,CAAE5D,WAAW,IAAI;QACxCA,WAAW,CAAC6D,IAAI,GAAG7D,WAAW,CAAC2D,MAAM,KAAKD,MAAM;MAClD,CAAC,CAAC;;EAEN;CACD;AApLY1E,cAAc,GAAA8E,UAAA,EAL1BnF,SAAS,CAAC;EACToF,QAAQ,EAAE,WAAW;EACrBC,WAAW,EAAE,wBAAwB;EACrCC,SAAS,EAAE,CAAC,uBAAuB;CACpC,CAAC,C,EACWjF,cAAc,CAoL1B;SApLYA,cAAc"},"metadata":{},"sourceType":"module","externalDependencies":[]}